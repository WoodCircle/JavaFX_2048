<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>game5_3x3</title>
    <script  src="js/jquery-3.6.0.min.js"></script>
    <!--图片样式-->
    <style>
        img {
            width: 100px;
            height: 100px;
            background-size: cover;
            float: left;
        }
        .image_a_1 {
            background-image: url("/image/game5_01.gif");
        }
        .image_a_2 {
            background-image: url("/image/game5_02.gif");
        }
        .image_a_3 {
            background-image: url("/image/game5_03.gif");
        }
        .image_a_4 {
            background-image: url("/image/game5_04.gif");
        }
        .image_a_5 {
            background-image: url("/image/game5_05.gif");
        }
        .image_a_6 {
            background-image: url("/image/game5_06.gif");
        }
        .image_a_7 {
            background-image: url("/image/game5_07.gif");
        }
        .image_a_8 {
            background-image: url("/image/game5_08.gif");
        }
        .image_a_9 {
            background-color: white;
        }
    </style>
    <!--成功提示-->
    <style>
        .sucess {
            width: 300px;
            height: 50px;
            margin-left: auto;
            margin-right: auto;
            margin-top: 40px;
            display: none;
        }
    </style>

    <script>

        $(function () {

            //生成图片随机顺序
            var arr = [1,2,3,4,5,6,7,8,9];
            var ran = [1,-1,3,-3];//移动方向，分别代表右左下上
            var arr1 = [1,2,3,4,5,6,7,9,8];//用于测试
            var arr2 = [];//用于测试

            var empIndex = 8;//空白块对应arr的索引，初始索引为8
            var disorder = 9;//打乱的程度
            var min = 30;//限制最少循环次数
            while (disorder>0 || min>0) {
                disorder = 0;
                min--;
                //从数组ran中随机选择空白块移动的方向
                var step = ran[Math.floor((Math.random()*4))];
                arr2.push(step);

                if(step===1){
                    //如果step为1
                    if((empIndex%3)!==2){
                        //符合换位条件，将arr[empIndex]与arr[empIndex+1]交换，即空白块右移
                        var t = arr[empIndex];
                        arr[empIndex] = arr[empIndex+1];
                        arr[empIndex+1] = t;
                        //交换后更新empIndex的值
                        empIndex = empIndex+1;
                    }
                }else if (step===-1){
                    //如果step为-1
                    if((empIndex%3)!==0){
                        //符合换位条件，将arr[empIndex]与arr[empIndex-1]交换，即空白块左移
                        var t = arr[empIndex];
                        arr[empIndex] = arr[empIndex-1];
                        arr[empIndex-1] = t;
                        empIndex = empIndex-1;
                    }

                }else if (step===3){
                    //如果step为3
                    if(empIndex<6){
                        //符合换位条件，将arr[empIndex]与arr[empIndex+3]交换，即空白块下移
                        var t = arr[empIndex];
                        arr[empIndex] = arr[empIndex+3];
                        arr[empIndex+3] = t;
                        empIndex = empIndex+3;
                    }

                }else{
                    //如果step为-3
                    if(empIndex>2){
                        //符合换位条件，将arr[empIndex]与arr[empIndex-3]交换，即空白块上移
                        var t = arr[empIndex];
                        arr[empIndex] = arr[empIndex-3];
                        arr[empIndex-3] = t;
                        empIndex = empIndex-3;
                    }
                }

                //判断arr的打乱程度
                for (var k = 0; k < 9; k++) {
                    if (arr[k]===k+1){
                        disorder = disorder + 1;
                    }
                }
            }

            //alert(arr2);

            //随机放置图片
            for (var j = 0; j < 9; j++) {
                var index = "img"+(j+1).toString();
                var className = "image_a_"+arr[j];//将 arr 改为 arr1 以测试游戏成功判定功能
                var element = document.getElementById(index);
                element.classList.add(className);
            }

            //图片点击事件
            $("img").click(function () {
                //获取当前点击元素的id
                var thisId = $(this).attr("id");
                //获取空白块的id
                var $imageA9 = $(".image_a_9");
                var targetId = $imageA9.attr("id");

                var thisIndex = Number(thisId[3]);/*点击索引*/
                var targetIndex = Number(targetId[3]);/*目标索引*/

                if((thisIndex%3===0&&targetIndex%3===1)||(thisIndex%3===1&&targetIndex%3===0)){

                }else if (((thisIndex-targetIndex)===-1)||((thisIndex-targetIndex)===1)||((thisIndex-targetIndex)===-3)||((thisIndex-targetIndex)===3)){
                    //获取当前元素class
                    var thisClass = $(this).attr("class");
                    //交换当前元素与目标元素class
                    $(this).removeClass(thisClass);
                    $(this).addClass("image_a_9");
                    $imageA9.removeClass("image_a_9");
                    $imageA9.addClass(thisClass);

                    //判断是否完成
                    var flag = 0;
                    for (var i = 1; i < 10; i++) {
                        var id = "img" + i.toString();
                        var myElement = document.getElementById(id);
                        var classNo = Number((myElement.classList.toString())[8]);
                        if(classNo !== i){
                            flag = 1;
                            break;
                        }
                    }
                    if(flag===0){
                        $("#success").css("display","block");
                    }
                }
            })
        });
    </script>
</head>
<body>
<div style="width:300px;height:300px;margin-left:auto;margin-right:auto;margin-top:auto;">
    <img id="img1">
    <img id="img2">
    <img id="img3">
    <img id="img4">
    <img id="img5">
    <img id="img6">
    <img id="img7">
    <img id="img8">
    <img id="img9">
</div>
<div id="success" class="sucess">
    <span style="text-align:center;font-size:30px;color:red">成功！！！</span>
</div>
<div style="width:300px;margin-left:auto;margin-right:auto;margin-top:50px">
    <a href="game5x3.html" style="background-color:rgba(11,98,216,0.9);color:white;padding:16px 25px;text-align:center;text-decoration:none;display:block;font-size:30px">重新开始</a>
</div>
<div style="width:300px;margin-left:auto;margin-right:auto;margin-top:35px">
    <a href="main.html" style="background-color:rgba(199,77,0,0.9);color:white;padding:11px 25px;text-align:center;text-decoration:none;display:block;font-size:30px">难度</a>
</div>
<div style="width:300px;margin-left:auto;margin-right:auto;margin-top:25px">
    <a href="main.html" style="background-color:rgba(199,77,0,0.9);color:white;padding:11px 25px;text-align:center;text-decoration:none;display:block;font-size:30px">图片</a>
</div>
<div style="width:300px;margin-left:auto;margin-right:auto;margin-top:280px;text-align:center">
    made by bijunen
</div>
</body>
</html>